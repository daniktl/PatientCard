{% extends "base.html" %}

{% block header %}

    <a class="btn-back" href="{{ back_url }}">back to the list</a>
    {{ patient.get_first_names_display() }} {{ patient.last_name }}

{% endblock %}

{% block content %}

    <div class="section-header">Patient data:</div>

    <table class="table table-hover">
        <tbody>
        <tr>
            <th>ID</th>
            <th>{{ patient.patient_id }}</th>
        </tr>
        <tr>
            <th>Last name</th>
            <th>{{ patient.last_name }}</th>
        </tr>
        <tr>
            <th>First name</th>
            <th>{{ patient.get_first_names_display() }}</th>
        </tr>
        <tr>
            <th>Gender</th>
            <th>{{ patient.get_gender_display() }}</th>
        </tr>
        <tr>
            <th>Birth date</th>
            <th>{{ patient.get_birth_date_display() }}</th>
        </tr>
        <tr>
            <th>Address</th>
            <th>{{ patient.get_address_display() }}</th>
        </tr>
        <tr>
            <th>Contact</th>
            <th>{{ patient.get_contact_display() }}</th>
        </tr>
        </tbody>
    </table>


    <div class="section-header">Events:</div>

    {% if events %}

    <form action="{{ current_url }}">

        <div class="form-row">
            <div class="col">
                <label for="date-from">From</label>
                <input type="date" id="date-from" class="form-control" name="from" value="{{ lower_date }}">
            </div>
            <div class="col">
                <label for="date-to">To</label>
                <input type="date" id="date-to" class="form-control" name="to" value="{{ upper_date }}">
            </div>
            <div class="col">
                <button type="submit" class="btn btn-primary mb-2">Filter</button>
            </div>
        </div>
    </form>

    {% for event in events %}
        <div class="observation">
            {% if event.resource == "observation" %}
                <div class="observation-icon"></div>
                <div class="observation-datetime">
                    <div class="observation-time">{{ event.get_observation_time_display() }}</div>
                    <div class="observation-date">{{ event.get_observation_date_display() }}</div>
                </div>
                <div class="observation-description">
                    <div class="observation-code">{{ event.get_code_display() }} </div>
                    <div class="observation-category">{{ event.get_category_display() }}</div>
                </div>
                <div class="observation-quantity">
                    <div class="observation-quantity-value">
                        {{ event.get_quantity_value_display() }}
                    </div>
                    <div class="observation-quantity-unit">
                        {{ event.get_quantity_unit_display() }}
                    </div>
                </div>
                <div class="observation-more">
                    <a href="{{ url_for("observation_page", observation_id=event.observation_id) }}">More</a>
                </div>
            {% elif event.resource == "medication_statements" %}
                <div class="medicament-icon"></div>
                <div class="observation-datetime">
                    <div class="observation-time">{{ event.get_event_time_display() }}</div>
                    <div class="observation-date">{{ event.get_event_date_display() }}</div>
                </div>
                <div class="observation-description">
                    <div class="observation-code">{{ event.get_code_display() }} </div>
                    <div class="observation-category">{{ event.get_category_display() }}</div>
                </div>
                <div class="observation-quantity">
                    <div class="observation-quantity-value {{ "observatio-quantity-value-digit" if event.get_quantity_value_display().isnumeric() else "" }}">
                        {{ event.get_quantity_value_display()|safe }}
                    </div>
                    <div class="observation-quantity-unit">
                        {{ event.get_quantity_unit_display() }}
                    </div>
                </div>
            {% endif %}
        </div>
    {% endfor %}

    {% else %}
        <div class="no-data">This patient has no events</div>
    {% endif %}


{% endblock %}